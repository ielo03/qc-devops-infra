name: Test

on:
  workflow_dispatch:

jobs:
  Terminate-Instance:
    runs-on: Ubuntu-24.04
    if: always()  # This ensures the job runs regardless of previous failures.
    env:
      AWS_REGION: us-west-1
      ECR_ACCOUNT: ${{ secrets.AWS_ACCOUNT_ID }}
    steps:
      - name: Configure AWS Credentials
        uses: aws-actions/configure-aws-credentials@v2
        with:
          aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }}
          aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
          aws-region: ${{ env.AWS_REGION }}
    
      - name: Terminate EC2 instance if exists
        run: |
          if [ -n "i-09c61361c04702ded" ]; then
            echo "Terminating EC2 instance i-09c61361c04702ded..."
            aws ec2 terminate-instances --instance-ids i-09c61361c04702ded --region us-west-1
          else
            echo "No EC2 instance was launched, failing termination."
            exit 1
          fi
